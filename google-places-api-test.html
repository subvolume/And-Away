<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API (NEW) - Side by Side Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f7;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #666;
        }

        .search-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.1rem;
            border: 2px solid #e1e1e3;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            border-color: #007aff;
        }

        .api-key-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
        }

        .api-key-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }

        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .result-column {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .result-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .result-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .result-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .result-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-top: 2px solid #007aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .result-item:hover {
            background-color: #f8f9fa;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item .main-text {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .autocomplete-item .secondary-text {
            color: #666;
            font-size: 0.9rem;
        }

        .textsearch-item .name {
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .textsearch-item .address {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .textsearch-item .details {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

                 .detail-badge {
             padding: 4px 8px;
             border-radius: 4px;
             font-size: 0.8rem;
             font-weight: 500;
         }

         .rating {
             background: #ff9500;
             color: white;
         }

         .price {
             background: #34c759;
             color: white;
         }

         .types {
             background: #007aff;
             color: white;
         }

         .distance {
             background: #8e44ad;
             color: white;
         }

        .error {
            color: #ff3b30;
            background: #fff0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .stats {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .results-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 1024px) and (min-width: 769px) {
            .results-container {
                grid-template-columns: 1fr 1fr;
                grid-auto-rows: auto;
            }
            
            .result-column:nth-child(3) {
                grid-column: 1 / -1;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 20px;
            max-height: calc(90vh - 100px);
            overflow-y: auto;
        }

        .json-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
        }

        .clickable-item {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .clickable-item:hover {
            background-color: #f0f8ff !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .clickable-item::after {
            content: "üëÅÔ∏è Click to view raw data";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 10px;
            color: #666;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .clickable-item:hover::after {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Google Places API (NEW) Test</h1>
            <p>Three-way comparison of Autocomplete vs Text Search vs Nearby Search</p>
        </div>

        <div class="search-section">
            <div class="api-key-section">
                <label for="apiKey"><strong>Google Places API Key:</strong></label>
                <input type="text" id="apiKey" class="api-key-input" placeholder="Enter your Google Places API key here">
                <small style="display: block; margin-top: 5px; color: #666;">
                    Make sure the key has Places API enabled and proper restrictions.
                </small>
            </div>
            
            <input 
                type="text" 
                id="searchInput" 
                class="search-input" 
                placeholder="Search for places (e.g., 'coffee shops in San Francisco')"
                disabled
            >
        </div>

        <div class="results-container">
            <!-- Autocomplete Results -->
            <div class="result-column">
                <div class="result-header">
                    <h3>üîç Autocomplete (NEW)</h3>
                    <p>Search suggestions and predictions</p>
                </div>
                <div class="result-content" id="autocompleteResults">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        Enter your API key and start typing to see autocomplete suggestions
                    </div>
                </div>
            </div>

            <!-- Text Search Results -->
            <div class="result-column">
                <div class="result-header">
                    <h3>üìç Text Search (NEW)</h3>
                    <p>Complete place details and information</p>
                </div>
                <div class="result-content" id="textSearchResults">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        Enter your API key and start typing to see detailed place results
                    </div>
                </div>
            </div>

            <!-- Nearby Search Results -->
            <div class="result-column">
                <div class="result-header">
                    <h3>üìç Nearby Search (NEW)</h3>
                    <p>Places near current location</p>
                </div>
                <div class="result-content" id="nearbySearchResults">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        Enter your API key and start typing to see nearby places
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for displaying raw data -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Raw Data</h2>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalData" class="json-display"></div>
            </div>
        </div>
    </div>

    <script>
        let searchTimeout;
        let isSearching = false;
        
        // Store raw data for modal display
        let rawAutocompleteData = null;
        let rawTextSearchData = null;
        let rawNearbySearchData = null;

        const apiKeyInput = document.getElementById('apiKey');
        const searchInput = document.getElementById('searchInput');
        const autocompleteResults = document.getElementById('autocompleteResults');
        const textSearchResults = document.getElementById('textSearchResults');
        const nearbySearchResults = document.getElementById('nearbySearchResults');

        // Enable search input when API key is provided
        apiKeyInput.addEventListener('input', function() {
            const hasApiKey = this.value.trim().length > 0;
            searchInput.disabled = !hasApiKey;
            
            if (hasApiKey) {
                searchInput.focus();
            } else {
                clearResults();
            }
        });

        // Search as you type
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            if (query.length === 0) {
                clearResults();
                return;
            }

            // Debounce search
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 500);
        });

        function clearResults() {
            autocompleteResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Start typing to see results</div>';
            textSearchResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Start typing to see results</div>';
            nearbySearchResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Start typing to see results</div>';
        }

        async function performSearch(query) {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                showError('Please enter your Google Places API key');
                return;
            }

            isSearching = true;
            showLoading();

            try {
                // Perform all three searches in parallel
                const [autocompleteData, textSearchData, nearbySearchData] = await Promise.all([
                    performAutocomplete(query, apiKey),
                    performTextSearch(query, apiKey),
                    performNearbySearch(query, apiKey)
                ]);

                // Store raw data for modal display
                rawAutocompleteData = autocompleteData;
                rawTextSearchData = textSearchData;
                rawNearbySearchData = nearbySearchData;

                displayAutocompleteResults(autocompleteData);
                displayTextSearchResults(textSearchData);
                displayNearbySearchResults(nearbySearchData);
            } catch (error) {
                console.error('Search error:', error);
                showError('Search failed: ' + error.message);
            } finally {
                isSearching = false;
            }
        }

                 async function performAutocomplete(query, apiKey) {
             const response = await fetch('https://places.googleapis.com/v1/places:autocomplete', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                     'X-Goog-Api-Key': apiKey,
                     'X-Goog-FieldMask': 'suggestions.placePrediction.text,suggestions.placePrediction.placeId,suggestions.placePrediction.types,suggestions.placePrediction.distanceMeters,suggestions.placePrediction.structuredFormat,suggestions.queryPrediction'
                 },
                 body: JSON.stringify({
                     input: query,
                     origin: {
                         latitude: 52.67859059644832,
                         longitude: 4.6987373652922155
                     },
                     locationBias: {
                         circle: {
                             center: {
                                 latitude: 52.67859059644832,
                                 longitude: 4.6987373652922155
                             },
                             radius: 5000
                         }
                     }
                 })
             });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Autocomplete API error: ${response.status} - ${errorText}`);
            }

            return await response.json();
        }

                 async function performTextSearch(query, apiKey) {
             const response = await fetch('https://places.googleapis.com/v1/places:searchText', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                     'X-Goog-Api-Key': apiKey,
                     'X-Goog-FieldMask': 'places.displayName,places.formattedAddress,places.location,places.rating,places.priceLevel,places.types,places.id,places.nationalPhoneNumber,places.internationalPhoneNumber,places.websiteUri,places.googleMapsUri,places.userRatingCount,places.businessStatus,places.currentOpeningHours,places.regularOpeningHours,places.photos,places.reviews,places.addressComponents,places.plusCode,places.accessibilityOptions,places.parkingOptions,places.paymentOptions,places.outdoorSeating,places.liveMusic,places.menuForChildren,places.servesCocktails,places.servesDessert,places.servesCoffee,places.goodForChildren,places.allowsDogs,places.restroom,places.goodForGroups,places.goodForWatchingSports,places.takeout,places.delivery,places.dineIn,places.curbsidePickup,places.reservable,places.servesBreakfast,places.servesLunch,places.servesDinner,places.servesBeer,places.servesWine,places.servesVegetarianFood,places.primaryType,places.shortFormattedAddress'
                 },
                 body: JSON.stringify({
                     textQuery: query,
                     locationBias: {
                         circle: {
                             center: {
                                 latitude: 52.67859059644832,
                                 longitude: 4.6987373652922155
                             },
                             radius: 50000
                         }
                     },
                     pageSize: 20
                 })
             });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Text Search API error: ${response.status} - ${errorText}`);
            }

            return await response.json();
        }

        async function performNearbySearch(query, apiKey) {
            // Determine relevant place types based on search query
            const placeTypes = getRelevantPlaceTypes(query);
            
            const response = await fetch('https://places.googleapis.com/v1/places:searchNearby', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Goog-Api-Key': apiKey,
                    'X-Goog-FieldMask': 'places.displayName,places.formattedAddress,places.location,places.rating,places.priceLevel,places.types,places.id,places.nationalPhoneNumber,places.internationalPhoneNumber,places.websiteUri,places.googleMapsUri,places.userRatingCount,places.businessStatus,places.currentOpeningHours,places.regularOpeningHours,places.photos,places.reviews,places.addressComponents,places.plusCode,places.accessibilityOptions,places.parkingOptions,places.paymentOptions,places.outdoorSeating,places.liveMusic,places.menuForChildren,places.servesCocktails,places.servesDessert,places.servesCoffee,places.goodForChildren,places.allowsDogs,places.restroom,places.goodForGroups,places.goodForWatchingSports,places.takeout,places.delivery,places.dineIn,places.curbsidePickup,places.reservable,places.servesBreakfast,places.servesLunch,places.servesDinner,places.servesBeer,places.servesWine,places.servesVegetarianFood,places.primaryType,places.shortFormattedAddress'
                },
                body: JSON.stringify({
                    includedTypes: placeTypes,
                    locationRestriction: {
                        circle: {
                            center: {
                                latitude: currentLat,
                                longitude: currentLon
                            },
                            radius: 5000
                        }
                    },
                    maxResultCount: 20,
                    rankPreference: "DISTANCE"
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Nearby Search API error: ${response.status} - ${errorText}`);
            }

            return await response.json();
        }

        function getRelevantPlaceTypes(query) {
            const lowerQuery = query.toLowerCase();
            
            // Food & Drink related
            if (lowerQuery.includes('coffee') || lowerQuery.includes('cafe') || lowerQuery.includes('espresso')) {
                return ['cafe', 'coffee_shop'];
            }
            if (lowerQuery.includes('restaurant') || lowerQuery.includes('food') || lowerQuery.includes('eat') || 
                lowerQuery.includes('dinner') || lowerQuery.includes('lunch') || lowerQuery.includes('meal')) {
                return ['restaurant', 'meal_takeaway', 'meal_delivery'];
            }
            if (lowerQuery.includes('bar') || lowerQuery.includes('drink') || lowerQuery.includes('beer') || 
                lowerQuery.includes('wine') || lowerQuery.includes('cocktail')) {
                return ['bar', 'night_club'];
            }
            if (lowerQuery.includes('pizza')) {
                return ['meal_takeaway', 'restaurant'];
            }
            
            // Shopping related
            if (lowerQuery.includes('shop') || lowerQuery.includes('store') || lowerQuery.includes('buy') || 
                lowerQuery.includes('mall') || lowerQuery.includes('market')) {
                return ['shopping_mall', 'department_store', 'clothing_store', 'electronics_store'];
            }
            if (lowerQuery.includes('grocery') || lowerQuery.includes('supermarket')) {
                return ['supermarket', 'grocery_or_supermarket'];
            }
            
            // Tourism & Entertainment
            if (lowerQuery.includes('museum') || lowerQuery.includes('art') || lowerQuery.includes('gallery')) {
                return ['museum', 'art_gallery'];
            }
            if (lowerQuery.includes('park') || lowerQuery.includes('green') || lowerQuery.includes('nature')) {
                return ['park', 'campground'];
            }
            if (lowerQuery.includes('tourist') || lowerQuery.includes('attraction') || lowerQuery.includes('sightseeing')) {
                return ['tourist_attraction', 'museum', 'art_gallery'];
            }
            if (lowerQuery.includes('movie') || lowerQuery.includes('cinema') || lowerQuery.includes('film')) {
                return ['movie_theater'];
            }
            
            // Services
            if (lowerQuery.includes('hotel') || lowerQuery.includes('stay') || lowerQuery.includes('accommodation')) {
                return ['lodging'];
            }
            if (lowerQuery.includes('gas') || lowerQuery.includes('fuel') || lowerQuery.includes('petrol')) {
                return ['gas_station'];
            }
            if (lowerQuery.includes('bank') || lowerQuery.includes('atm') || lowerQuery.includes('money')) {
                return ['bank', 'atm'];
            }
            if (lowerQuery.includes('hospital') || lowerQuery.includes('doctor') || lowerQuery.includes('medical')) {
                return ['hospital', 'doctor'];
            }
            
            // Transportation
            if (lowerQuery.includes('train') || lowerQuery.includes('station') || lowerQuery.includes('subway')) {
                return ['train_station', 'subway_station'];
            }
            if (lowerQuery.includes('airport') || lowerQuery.includes('flight')) {
                return ['airport'];
            }
            
            // Default: return a mix of common types if no specific match
            return ['restaurant', 'cafe', 'tourist_attraction', 'shopping_mall', 'park'];
        }

        function showLoading() {
            autocompleteResults.innerHTML = '<div class="loading">Loading autocomplete suggestions</div>';
            textSearchResults.innerHTML = '<div class="loading">Loading place details</div>';
            nearbySearchResults.innerHTML = '<div class="loading">Loading nearby places</div>';
        }

        function showError(message) {
            const errorHtml = `<div class="error">${message}</div>`;
            autocompleteResults.innerHTML = errorHtml;
            textSearchResults.innerHTML = errorHtml;
            nearbySearchResults.innerHTML = errorHtml;
        }

                 function displayAutocompleteResults(data) {
             if (!data.suggestions || data.suggestions.length === 0) {
                 autocompleteResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No autocomplete suggestions found</div>';
                 return;
             }

             let html = '';
             
             data.suggestions.forEach((suggestion, index) => {
                 if (suggestion.placePrediction) {
                     const prediction = suggestion.placePrediction;
                     const mainText = prediction.text?.text || 'Unknown';
                     const types = prediction.types || [];
                     const distanceMeters = prediction.distanceMeters;
                     
                     html += `
                         <div class="result-item autocomplete-item clickable-item" onclick="showModal('Autocomplete Result: ${escapeHtml(mainText)}', rawAutocompleteData.suggestions[${index}])">
                             <div class="main-text">${escapeHtml(mainText)}</div>
                             <div class="secondary-text">Place ID: ${escapeHtml(prediction.placeId || 'N/A')}</div>
                     `;
                     
                     // Show distance if available
                     if (distanceMeters !== undefined) {
                         html += `<div style="margin-top: 8px;"><span class="detail-badge distance">üìç ${formatDistance(distanceMeters)}</span></div>`;
                     }
                     
                     if (types.length > 0) {
                         html += `<div style="margin-top: 8px;"><strong>Categories:</strong> ${types.map(type => `<span class="detail-badge types">${escapeHtml(type)}</span>`).join(' ')}</div>`;
                     }
                     
                     html += `</div>`;
                 }
             });

             html += `<div class="stats">Found ${data.suggestions.length} suggestions</div>`;
             autocompleteResults.innerHTML = html;
         }

        function displayTextSearchResults(data) {
            if (!data.places || data.places.length === 0) {
                textSearchResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No places found</div>';
                return;
            }

            let html = '';
            
                         data.places.forEach((place, index) => {
                 const name = place.displayName?.text || 'Unknown';
                 const address = place.formattedAddress || 'Address not available';
                 const rating = place.rating;
                 const priceLevel = place.priceLevel;
                 const types = place.types || [];
                 const location = place.location;

                 html += `
                     <div class="result-item textsearch-item clickable-item" onclick="showModal('Text Search Result: ${escapeHtml(name)}', rawTextSearchData.places[${index}])">
                         <div class="name">${escapeHtml(name)}</div>
                         <div class="address">${escapeHtml(address)}</div>
                         <div class="details">
                 `;

                 // Calculate and show distance
                 if (location && location.latitude && location.longitude) {
                     const distanceKm = calculateDistance(currentLat, currentLon, location.latitude, location.longitude);
                     const distanceMeters = distanceKm * 1000;
                     html += `<span class="detail-badge distance">üìç ${formatDistance(distanceMeters)}</span>`;
                 }

                 if (rating) {
                     html += `<span class="detail-badge rating">‚òÖ ${rating.toFixed(1)}</span>`;
                 }

                 if (priceLevel) {
                     html += `<span class="detail-badge price">${escapeHtml(priceLevel)}</span>`;
                 }

                 html += `</div>`;

                 if (types.length > 0) {
                     html += `<div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;"><strong style="margin-right: 8px;">Categories:</strong> ${types.map(type => `<span class="detail-badge types">${escapeHtml(type)}</span>`).join(' ')}</div>`;
                 }

                 html += `
                     </div>
                 `;
             });

            html += `<div class="stats">Found ${data.places.length} places</div>`;
            textSearchResults.innerHTML = html;
        }

        function displayNearbySearchResults(data) {
            if (!data.places || data.places.length === 0) {
                nearbySearchResults.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No nearby places found</div>';
                return;
            }

            let html = '';
            
            data.places.forEach((place, index) => {
                const name = place.displayName?.text || 'Unknown';
                const address = place.formattedAddress || 'Address not available';
                const rating = place.rating;
                const priceLevel = place.priceLevel;
                const types = place.types || [];
                const location = place.location;

                html += `
                    <div class="result-item textsearch-item clickable-item" onclick="showModal('Nearby Search Result: ${escapeHtml(name)}', rawNearbySearchData.places[${index}])">
                        <div class="name">${escapeHtml(name)}</div>
                        <div class="address">${escapeHtml(address)}</div>
                        <div class="details">
                `;

                // Calculate and show distance
                if (location && location.latitude && location.longitude) {
                    const distanceKm = calculateDistance(currentLat, currentLon, location.latitude, location.longitude);
                    const distanceMeters = distanceKm * 1000;
                    html += `<span class="detail-badge distance">üìç ${formatDistance(distanceMeters)}</span>`;
                }

                if (rating) {
                    html += `<span class="detail-badge rating">‚òÖ ${rating.toFixed(1)}</span>`;
                }

                if (priceLevel) {
                    html += `<span class="detail-badge price">${escapeHtml(priceLevel)}</span>`;
                }

                html += `</div>`;

                if (types.length > 0) {
                    html += `<div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;"><strong style="margin-right: 8px;">Categories:</strong> ${types.map(type => `<span class="detail-badge types">${escapeHtml(type)}</span>`).join(' ')}</div>`;
                }

                html += `
                    </div>
                `;
            });

            html += `<div class="stats">Found ${data.places.length} nearby places</div>`;
            nearbySearchResults.innerHTML = html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

                 // Distance calculation function (Haversine formula)
         function calculateDistance(lat1, lon1, lat2, lon2) {
             const R = 6371; // Radius of the Earth in kilometers
             const dLat = (lat2 - lat1) * Math.PI / 180;
             const dLon = (lon2 - lon1) * Math.PI / 180;
             const a = 
                 Math.sin(dLat/2) * Math.sin(dLat/2) +
                 Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                 Math.sin(dLon/2) * Math.sin(dLon/2);
             const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
             const distance = R * c; // Distance in kilometers
             return distance;
         }

         function formatDistance(meters) {
             if (meters < 1000) {
                 return `${Math.round(meters)}m`;
             } else {
                 return `${(meters / 1000).toFixed(1)}km`;
             }
         }

         // Current location coordinates
         const currentLat = 52.67859059644832;
         const currentLon = 4.6987373652922155;

                 // Modal functions
        function showModal(title, data) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalData').innerHTML = formatDataForDisplay(data);
            document.getElementById('dataModal').style.display = 'block';
        }

        function formatDataForDisplay(data) {
            let html = '';
            
            // Handle autocomplete predictions
            if (data.placePrediction) {
                const prediction = data.placePrediction;
                html += `<div style="margin-bottom: 20px;">`;
                html += `<h3 style="color: #667eea; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 8px;">üîç Autocomplete Prediction</h3>`;
                
                if (prediction.text?.text) {
                    html += `<div style="margin-bottom: 10px;"><strong>Text:</strong> ${escapeHtml(prediction.text.text)}</div>`;
                }
                if (prediction.placeId) {
                    html += `<div style="margin-bottom: 10px;"><strong>Place ID:</strong> <code style="background: #f1f3f4; padding: 2px 6px; border-radius: 4px;">${escapeHtml(prediction.placeId)}</code></div>`;
                }
                if (prediction.types && prediction.types.length > 0) {
                    html += `<div style="margin-bottom: 10px;"><strong>Types:</strong> ${prediction.types.map(type => `<span style="background: #e3f2fd; color: #1976d2; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 4px;">${escapeHtml(type)}</span>`).join('')}</div>`;
                }
                if (prediction.distanceMeters !== undefined) {
                    html += `<div style="margin-bottom: 10px;"><strong>Distance:</strong> ${formatDistance(prediction.distanceMeters)}</div>`;
                }
                html += `</div>`;
            }
            
            // Handle place details (from text search or nearby search)
            else if (data.displayName || data.formattedAddress || data.location) {
                html += `<div style="margin-bottom: 20px;">`;
                html += `<h3 style="color: #667eea; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 8px;">üìç Place Details</h3>`;
                
                if (data.displayName?.text) {
                    html += `<div style="margin-bottom: 10px;"><strong>Name:</strong> ${escapeHtml(data.displayName.text)}</div>`;
                }
                if (data.id) {
                    html += `<div style="margin-bottom: 10px;"><strong>Place ID:</strong> <code style="background: #f1f3f4; padding: 2px 6px; border-radius: 4px;">${escapeHtml(data.id)}</code></div>`;
                }
                if (data.formattedAddress) {
                    html += `<div style="margin-bottom: 10px;"><strong>Address:</strong> ${escapeHtml(data.formattedAddress)}</div>`;
                }
                if (data.location) {
                    html += `<div style="margin-bottom: 10px;"><strong>Location:</strong> ${data.location.latitude?.toFixed(6)}, ${data.location.longitude?.toFixed(6)}</div>`;
                }
                if (data.types && data.types.length > 0) {
                    html += `<div style="margin-bottom: 10px;"><strong>Types:</strong> ${data.types.map(type => `<span style="background: #e8f5e8; color: #2e7d32; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 4px;">${escapeHtml(type)}</span>`).join('')}</div>`;
                }
                if (data.rating) {
                    html += `<div style="margin-bottom: 10px;"><strong>Rating:</strong> ‚≠ê ${data.rating.toFixed(1)}</div>`;
                }
                if (data.priceLevel) {
                    html += `<div style="margin-bottom: 10px;"><strong>Price Level:</strong> ${escapeHtml(data.priceLevel)}</div>`;
                }
                if (data.userRatingCount) {
                    html += `<div style="margin-bottom: 10px;"><strong>Review Count:</strong> ${data.userRatingCount.toLocaleString()} reviews</div>`;
                }
                if (data.websiteUri) {
                    html += `<div style="margin-bottom: 10px;"><strong>Website:</strong> <a href="${escapeHtml(data.websiteUri)}" target="_blank" style="color: #1976d2;">${escapeHtml(data.websiteUri)}</a></div>`;
                }
                if (data.nationalPhoneNumber) {
                    html += `<div style="margin-bottom: 10px;"><strong>Phone:</strong> <a href="tel:${escapeHtml(data.nationalPhoneNumber)}" style="color: #1976d2;">${escapeHtml(data.nationalPhoneNumber)}</a></div>`;
                }
                if (data.googleMapsUri) {
                    html += `<div style="margin-bottom: 10px;"><strong>Google Maps:</strong> <a href="${escapeHtml(data.googleMapsUri)}" target="_blank" style="color: #1976d2;">View on Maps</a></div>`;
                }
                html += `</div>`;
            }
            
            // Add raw JSON section
            html += `<div style="margin-top: 30px;">`;
            html += `<h3 style="color: #666; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 8px;">üîß Raw JSON Data</h3>`;
            html += `<pre style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 11px; line-height: 1.4; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; max-height: 300px; overflow-y: auto;">${escapeHtml(JSON.stringify(data, null, 2))}</pre>`;
            html += `</div>`;
            
            return html;
        }

        function closeModal() {
            document.getElementById('dataModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('dataModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Log API responses for debugging
        console.log('Google Places API (NEW) Test Page Loaded');
        console.log('Make sure your API key has Places API enabled and proper restrictions');
    </script>
</body>
</html> 