<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API Tester - And Away Project</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #0056CC;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .api-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .api-header {
            padding: 15px 20px;
            font-weight: bold;
            color: white;
        }
        
        .text-search .api-header {
            background: #FF6B35;
        }
        
        .autocomplete .api-header {
            background: #4ECDC4;
        }
        
        .nearby .api-header {
            background: #9B59B6;
        }
        
        .api-content {
            padding: 20px;
        }
        
        .result-item {
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 6px;
            margin-bottom: 10px;
            background: #fafafa;
        }
        
        .result-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-address {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .result-meta {
            font-size: 12px;
            color: #999;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            color: #FF3B30;
            padding: 15px;
            background: #FFF5F5;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .timing {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .raw-response {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        
        .toggle {
            margin: 10px 0;
        }
        
        .toggle input {
            margin-right: 5px;
        }
        
        .stats {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 1024px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üó∫Ô∏è Google Places API Tester</h1>
        <p><strong>And Away Project - Step 4 Testing</strong></p>
        <p>Location: Netherlands (52.6786, 4.6988) | Testing Text Search vs Autocomplete APIs</p>
    </div>

    <div class="controls">
        <input type="text" 
               id="searchInput" 
               class="search-input" 
               placeholder="Type to search (e.g., coffee, restaurant, albert heijn)">
        
        <div class="button-group">
            <button class="test-btn" onclick="testAllAPIs()">üîÑ Compare All 3 APIs</button>
            <button class="test-btn" onclick="testTextSearch()">üîç Text Search</button>
            <button class="test-btn" onclick="testAutocomplete()">üìù Autocomplete</button>
            <button class="test-btn" onclick="testNearbySearch()">üìç Nearby Search</button>
            <button class="test-btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div class="toggle">
            <label>
                <input type="checkbox" id="showRaw"> Show Raw API Responses
            </label>
        </div>

        <div class="toggle">
            <label>
                <input type="checkbox" id="autoSearch"> Search as you type (0.5s delay)
            </label>
        </div>

        <div style="margin-top: 10px;">
            <label for="apiKey">Google Places API Key:</label>
            <input type="password" 
                   id="apiKey" 
                   placeholder="Enter your Google Places API key"
                   style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
    </div>

    <div class="stats" id="statsContainer" style="display: none;">
        <h3>üìä Comparison Stats</h3>
        <div class="stat-grid">
            <div class="stat-item">
                <div class="stat-number" id="textSearchTime">-</div>
                <div class="stat-label">Text Search Response (ms)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="autocompleteTime">-</div>
                <div class="stat-label">Autocomplete Response (ms)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="nearbyTime">-</div>
                <div class="stat-label">Nearby Search Response (ms)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="textSearchCount">-</div>
                <div class="stat-label">Text Search Results</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="autocompleteCount">-</div>
                <div class="stat-label">Autocomplete Predictions</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="nearbyCount">-</div>
                <div class="stat-label">Nearby Search Results</div>
            </div>
        </div>
    </div>

    <div class="comparison-container">
        <div class="api-section text-search">
            <div class="api-header">
                üîç Google Text Search API
                <div style="font-size: 12px; font-weight: normal; opacity: 0.9;">
                    Complete place data | ~$32/1000 requests | Slower but comprehensive
                </div>
            </div>
            <div class="api-content" id="textSearchResults">
                <p style="color: #666; text-align: center; padding: 20px;">
                    Click "Compare All 3 APIs" or "Text Search" to test
                </p>
            </div>
        </div>

        <div class="api-section autocomplete">
            <div class="api-header">
                üìù Google Autocomplete API
                <div style="font-size: 12px; font-weight: normal; opacity: 0.9;">
                    Predictions only | ~$2.83/1000 requests | Faster but needs Place Details
                </div>
            </div>
            <div class="api-content" id="autocompleteResults">
                <p style="color: #666; text-align: center; padding: 20px;">
                    Click "Compare All 3 APIs" or "Autocomplete" to test
                </p>
            </div>
        </div>

        <div class="api-section nearby">
            <div class="api-header">
                üìç Google Nearby Search API
                <div style="font-size: 12px; font-weight: normal; opacity: 0.9;">
                    Location-based results | ~$32/1000 requests | Best for "near me" searches
                </div>
            </div>
            <div class="api-content" id="nearbyResults">
                <p style="color: #666; text-align: center; padding: 20px;">
                    Click "Compare All 3 APIs" or "Nearby Search" to test
                </p>
            </div>
        </div>
    </div>

    <script>
        // Your location coordinates (Netherlands)
        const LAT = 52.678606347967175;
        const LNG = 4.698801550831957;
        const RADIUS = 5000; // 5km radius

        let searchTimeout;
        let lastSearchTerm = '';

        // Auto-search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const autoSearch = document.getElementById('autoSearch').checked;
            if (!autoSearch) return;

            const searchTerm = this.value.trim();
            if (searchTerm === lastSearchTerm) return;

            clearTimeout(searchTimeout);
            
            if (searchTerm.length === 0) {
                clearResults();
                return;
            }

            searchTimeout = setTimeout(() => {
                             if (searchTerm.length >= 1) {
                 testAllAPIs();
             }
            }, 500);
        });

        function getAPIKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                alert('Please enter your Google Places API key first!');
                return null;
            }
            return apiKey;
        }

        function getSearchTerm() {
            const term = document.getElementById('searchInput').value.trim();
            if (!term) {
                alert('Please enter a search term!');
                return null;
            }
            return term;
        }

        async function testAllAPIs() {
            const apiKey = getAPIKey();
            const searchTerm = getSearchTerm();
            if (!apiKey || !searchTerm) return;

            lastSearchTerm = searchTerm;
            document.getElementById('statsContainer').style.display = 'block';

            // Test all three APIs simultaneously
            const [textSearchResult, autocompleteResult, nearbyResult] = await Promise.all([
                testTextSearchAPI(apiKey, searchTerm),
                testAutocompleteAPI(apiKey, searchTerm),
                testNearbySearchAPI(apiKey, searchTerm)
            ]);

            // Update stats
            updateStats(textSearchResult, autocompleteResult, nearbyResult);
        }

        async function testTextSearch() {
            const apiKey = getAPIKey();
            const searchTerm = getSearchTerm();
            if (!apiKey || !searchTerm) return;

            await testTextSearchAPI(apiKey, searchTerm);
        }

        async function testAutocomplete() {
            const apiKey = getAPIKey();
            const searchTerm = getSearchTerm();
            if (!apiKey || !searchTerm) return;

            await testAutocompleteAPI(apiKey, searchTerm);
        }

        async function testNearbySearch() {
            const apiKey = getAPIKey();
            const searchTerm = getSearchTerm();
            if (!apiKey || !searchTerm) return;

            await testNearbySearchAPI(apiKey, searchTerm);
        }

        async function testTextSearchAPI(apiKey, searchTerm) {
            const container = document.getElementById('textSearchResults');
            container.innerHTML = '<div class="loading">üîÑ Testing Text Search API...</div>';

            const startTime = performance.now();
            
            try {
                const encodedQuery = encodeURIComponent(searchTerm);
                const url = `https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodedQuery}&location=${LAT},${LNG}&radius=${RADIUS}&key=${apiKey}`;
                
                // Note: This will fail due to CORS in browser. Instructions provided below.
                const response = await fetch(url);
                const data = await response.json();
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                displayTextSearchResults(container, data, responseTime);
                return { responseTime, resultCount: data.results?.length || 0 };

            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                container.innerHTML = `
                    <div class="error">
                        <strong>CORS Error (Expected in Browser)</strong><br>
                        This is normal - browsers block direct Google API calls.<br><br>
                        <strong>To test properly:</strong><br>
                        1. Use browser extension to disable CORS temporarily<br>
                        2. Or test in your iOS app's SandboxView<br>
                        3. Or use a proxy server<br><br>
                        <strong>API URL being tested:</strong><br>
                        <code style="font-size: 10px; word-break: break-all;">
                        https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodeURIComponent(searchTerm)}&location=${LAT},${LNG}&radius=${RADIUS}&key=${apiKey}
                        </code>
                    </div>
                `;
                return { responseTime, resultCount: 0, error: true };
            }
        }

        async function testAutocompleteAPI(apiKey, searchTerm) {
            const container = document.getElementById('autocompleteResults');
            container.innerHTML = '<div class="loading">üîÑ Testing Autocomplete API...</div>';

            const startTime = performance.now();
            
            try {
                const encodedInput = encodeURIComponent(searchTerm);
                const url = `https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${encodedInput}&location=${LAT},${LNG}&radius=${RADIUS}&key=${apiKey}`;
                
                // Note: This will fail due to CORS in browser. Instructions provided below.
                const response = await fetch(url);
                const data = await response.json();
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                displayAutocompleteResults(container, data, responseTime);
                return { responseTime, resultCount: data.predictions?.length || 0 };

            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                container.innerHTML = `
                    <div class="error">
                        <strong>CORS Error (Expected in Browser)</strong><br>
                        This is normal - browsers block direct Google API calls.<br><br>
                        <strong>To test properly:</strong><br>
                        1. Use browser extension to disable CORS temporarily<br>
                        2. Or test in your iOS app's SandboxView<br>
                        3. Or use a proxy server<br><br>
                        <strong>API URL being tested:</strong><br>
                        <code style="font-size: 10px; word-break: break-all;">
                        https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${encodeURIComponent(searchTerm)}&location=${LAT},${LNG}&radius=${RADIUS}&key=${apiKey}
                        </code>
                    </div>
                `;
                return { responseTime, resultCount: 0, error: true };
            }
        }

        function displayTextSearchResults(container, data, responseTime) {
            const showRaw = document.getElementById('showRaw').checked;
            
            if (data.status !== 'OK') {
                container.innerHTML = `
                    <div class="error">API Error: ${data.status}<br>${data.error_message || ''}</div>
                `;
                return;
            }

            const results = data.results || [];
            
            let html = `
                <div class="timing">‚è±Ô∏è Response time: ${responseTime}ms | Results: ${results.length}</div>
            `;

            results.forEach((place, index) => {
                const rating = place.rating ? `‚≠ê ${place.rating}` : '';
                const priceLevel = place.price_level ? '$'.repeat(place.price_level) : '';
                
                html += `
                    <div class="result-item">
                        <div class="result-name">${place.name}</div>
                        <div class="result-address">${place.formatted_address}</div>
                        <div class="result-meta">
                            ${rating} ${priceLevel}
                            | Lat: ${place.geometry.location.lat.toFixed(4)}, 
                            Lng: ${place.geometry.location.lng.toFixed(4)}
                        </div>
                    </div>
                `;
            });

            if (showRaw) {
                html += `<div class="raw-response">${JSON.stringify(data, null, 2)}</div>`;
            }

            container.innerHTML = html;
        }

        function displayAutocompleteResults(container, data, responseTime) {
            const showRaw = document.getElementById('showRaw').checked;
            
            if (data.status !== 'OK') {
                container.innerHTML = `
                    <div class="error">API Error: ${data.status}<br>${data.error_message || ''}</div>
                `;
                return;
            }

            const predictions = data.predictions || [];
            
            let html = `
                <div class="timing">‚è±Ô∏è Response time: ${responseTime}ms | Predictions: ${predictions.length}</div>
            `;

            predictions.forEach((prediction, index) => {
                html += `
                    <div class="result-item">
                        <div class="result-name">${prediction.description}</div>
                        <div class="result-address">Place ID: ${prediction.place_id}</div>
                        <div class="result-meta">
                            Types: ${prediction.types ? prediction.types.slice(0, 3).join(', ') : 'N/A'}
                        </div>
                    </div>
                `;
            });

            html += `
                <div style="margin-top: 15px; padding: 10px; background: #FFF9E6; border-radius: 6px; font-size: 12px;">
                    üí° <strong>Note:</strong> Autocomplete only provides predictions. 
                    You'd need to call Place Details API with these Place IDs to get coordinates, ratings, photos, etc.
                </div>
            `;

            if (showRaw) {
                html += `<div class="raw-response">${JSON.stringify(data, null, 2)}</div>`;
            }

            container.innerHTML = html;
        }

        async function testNearbySearchAPI(apiKey, searchTerm) {
            const container = document.getElementById('nearbyResults');
            container.innerHTML = '<div class="loading">üîÑ Testing Nearby Search API...</div>';

            const startTime = performance.now();
            
            try {
                const encodedKeyword = encodeURIComponent(searchTerm);
                const url = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${LAT},${LNG}&radius=${RADIUS}&keyword=${encodedKeyword}&key=${apiKey}`;
                
                // Note: This will fail due to CORS in browser. Instructions provided below.
                const response = await fetch(url);
                const data = await response.json();
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                displayNearbyResults(container, data, responseTime);
                return { responseTime, resultCount: data.results?.length || 0 };

            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                container.innerHTML = `
                    <div class="error">
                        <strong>CORS Error (Expected in Browser)</strong><br>
                        This is normal - browsers block direct Google API calls.<br><br>
                        <strong>To test properly:</strong><br>
                        1. Use browser extension to disable CORS temporarily<br>
                        2. Or test in your iOS app's SandboxView<br>
                        3. Or use a proxy server<br><br>
                        <strong>API URL being tested:</strong><br>
                        <code style="font-size: 10px; word-break: break-all;">
                        https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${LAT},${LNG}&radius=${RADIUS}&keyword=${encodeURIComponent(searchTerm)}&key=${apiKey}
                        </code>
                    </div>
                `;
                return { responseTime, resultCount: 0, error: true };
            }
        }

        function displayNearbyResults(container, data, responseTime) {
            const showRaw = document.getElementById('showRaw').checked;
            
            if (data.status !== 'OK') {
                container.innerHTML = `
                    <div class="error">API Error: ${data.status}<br>${data.error_message || ''}</div>
                `;
                return;
            }

            const results = data.results || [];
            
            let html = `
                <div class="timing">‚è±Ô∏è Response time: ${responseTime}ms | Results: ${results.length}</div>
            `;

            results.forEach((place, index) => {
                const rating = place.rating ? `‚≠ê ${place.rating}` : '';
                const priceLevel = place.price_level ? '$'.repeat(place.price_level) : '';
                const vicinity = place.vicinity || 'No address';
                
                html += `
                    <div class="result-item">
                        <div class="result-name">${place.name}</div>
                        <div class="result-address">${vicinity}</div>
                        <div class="result-meta">
                            ${rating} ${priceLevel}
                            | Lat: ${place.geometry.location.lat.toFixed(4)}, 
                            Lng: ${place.geometry.location.lng.toFixed(4)}
                        </div>
                    </div>
                `;
            });

            html += `
                <div style="margin-top: 15px; padding: 10px; background: #F3E5F5; border-radius: 6px; font-size: 12px;">
                    üí° <strong>Note:</strong> Nearby Search is location-focused. 
                    It finds places around your coordinates using the search term as a keyword filter.
                </div>
            `;

            if (showRaw) {
                html += `<div class="raw-response">${JSON.stringify(data, null, 2)}</div>`;
            }

            container.innerHTML = html;
        }

        function updateStats(textSearchResult, autocompleteResult, nearbyResult) {
            document.getElementById('textSearchTime').textContent = 
                textSearchResult.error ? 'Error' : `${textSearchResult.responseTime}ms`;
            document.getElementById('autocompleteTime').textContent = 
                autocompleteResult.error ? 'Error' : `${autocompleteResult.responseTime}ms`;
            document.getElementById('nearbyTime').textContent = 
                nearbyResult?.error ? 'Error' : `${nearbyResult?.responseTime || '-'}ms`;
            document.getElementById('textSearchCount').textContent = textSearchResult.resultCount;
            document.getElementById('autocompleteCount').textContent = autocompleteResult.resultCount;
            document.getElementById('nearbyCount').textContent = nearbyResult?.resultCount || '-';
        }

        function clearResults() {
            document.getElementById('textSearchResults').innerHTML = 
                '<p style="color: #666; text-align: center; padding: 20px;">Click "Compare All 3 APIs" or "Text Search" to test</p>';
            document.getElementById('autocompleteResults').innerHTML = 
                '<p style="color: #666; text-align: center; padding: 20px;">Click "Compare All 3 APIs" or "Autocomplete" to test</p>';
            document.getElementById('nearbyResults').innerHTML = 
                '<p style="color: #666; text-align: center; padding: 20px;">Click "Compare All 3 APIs" or "Nearby Search" to test</p>';
            document.getElementById('statsContainer').style.display = 'none';
            lastSearchTerm = '';
        }

        // Add keyboard shortcut
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.activeElement.id === 'searchInput') {
                testAllAPIs();
            }
        });
    </script>

    <div style="margin-top: 30px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h3>üöÄ How to Use This Tester</h3>
        <ol>
            <li><strong>Enter your Google Places API key</strong> in the field above</li>
            <li><strong>Type a search term</strong> (e.g., "coffee", "restaurant", "albert heijn")</li>
            <li><strong>Click "Compare Both APIs"</strong> to test both simultaneously</li>
            <li><strong>Compare response times, result quality, and data richness</strong></li>
            <li><strong>Try different search patterns:</strong>
                <ul>
                    <li>Partial queries: "c" ‚Üí "co" ‚Üí "coffee"</li>
                    <li>Local brands: "albert heijn", "etos", "jumbo"</li>
                    <li>Generic terms: "restaurant", "pharmacy", "supermarket"</li>
                </ul>
            </li>
        </ol>

        <div style="margin-top: 15px; padding: 10px; background: #FFF3CD; border-radius: 6px;">
            <strong>‚ö†Ô∏è CORS Note:</strong> Modern browsers block direct API calls to Google due to CORS policy. 
            To test properly, you can:
            <ul style="margin: 5px 0;">
                <li>Install a browser extension to disable CORS temporarily</li>
                <li>Continue using your iOS SandboxView for actual testing</li>
                <li>Use this HTML as a reference for test scenarios</li>
            </ul>
        </div>
    </div>
</body>
</html> 